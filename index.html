<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Native AR Magic</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <style>
        #ui-layer {
            position: absolute; bottom: 30px; width: 100%; text-align: center; z-index: 10; pointer-events: none;
        }
        .btn-text {
            background: rgba(20, 0, 50, 0.8); color: #00ffff; padding: 12px 24px; border-radius: 30px;
            font-family: sans-serif; font-weight: bold; border: 1px solid #00ffff;
        }
    </style>
</head>
<body>
    <div id="ui-layer"><span class="btn-text">ğŸ‘† í™”ë©´ì„ í„°ì¹˜í•´ ì •ë ¹ì„ ì†Œí™˜í•˜ì„¸ìš”!</span></div>

    <a-scene 
        cursor="rayOrigin: mouse" 
        raycaster="objects: none"
        xr-mode-ui="enabled: true; enterAREnabled: true; XRMode: ar">

        <a-camera position="0 1.6 0"></a-camera>

        <a-light type="directional" position="1 4 2" intensity="0.6" color="#ccffcc"></a-light>
        <a-light type="ambient" intensity="0.4" color="#220033"></a-light>

    </a-scene>

    <script>
        // âœ… 1. 'ë‚˜ë¥¼ ì³ë‹¤ë³´ëŠ”' ê¸°ëŠ¥ (Look-At)
        AFRAME.registerComponent('look-at-camera', {
            tick: function () {
                if (!this.el.sceneEl.camera) return;
                this.el.object3D.lookAt(this.el.sceneEl.camera.el.object3D.position);
            }
        });

        const scene = document.querySelector('a-scene');
        const colors = ['#00ffff', '#ff00ff', '#ffff00', '#55ff00'];

        // âœ… 2. ì§ì ‘ ë§Œë“  íŒŒí‹°í´ í­ë°œ í•¨ìˆ˜ (ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëŒ€ì²´)
        function createExplosion(position, color) {
            const particleCount = 30; // í­ë°œ íŒŒí¸ ê°œìˆ˜

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('a-entity');
                
                // ì‘ì€ ì‚¬ê°í˜•ì´ë‚˜ êµ¬ ëª¨ì–‘
                particle.setAttribute('geometry', 'primitive: box; width: 0.02; height: 0.02; depth: 0.02');
                particle.setAttribute('material', `shader: flat; color: ${color}; transparent: true; opacity: 1`);
                particle.setAttribute('position', position);

                // ëœë¤í•œ ë°©í–¥ìœ¼ë¡œ í¼ì ¸ë‚˜ê°€ëŠ” ë²¡í„° ê³„ì‚°
                const xDir = (Math.random() - 0.5) * 2; // -1 ~ 1
                const yDir = (Math.random() - 0.5) * 2;
                const zDir = (Math.random() - 0.5) * 2;

                // ì• ë‹ˆë©”ì´ì…˜ 1: ë°–ìœ¼ë¡œ í¼ì§€ê¸°
                particle.setAttribute('animation__move', {
                    property: 'position',
                    to: `${position.x + xDir} ${position.y + yDir} ${position.z + zDir}`,
                    dur: 1000,
                    easing: 'easeOutQuad'
                });

                // ì• ë‹ˆë©”ì´ì…˜ 2: ì„œì„œíˆ ì‚¬ë¼ì§€ê¸°
                particle.setAttribute('animation__fade', {
                    property: 'material.opacity',
                    to: 0,
                    dur: 1000,
                    easing: 'linear'
                });

                // 1ì´ˆ ë’¤ ìë™ ì‚­ì œ (ë©”ëª¨ë¦¬ ê´€ë¦¬)
                setTimeout(() => {
                    if (particle.parentNode) particle.parentNode.removeChild(particle);
                }, 1000);

                scene.appendChild(particle);
            }
        }

        // âœ… 3. í„°ì¹˜ ì´ë²¤íŠ¸
        scene.addEventListener('click', (e) => {
            // ìœ„ì¹˜ ê³„ì‚°
            const camera = document.querySelector('a-camera');
            const pos = camera.getAttribute('position');
            const rot = camera.getAttribute('rotation');
            const angle = rot.y * (Math.PI / 180);
            
            // ëˆˆì• 0.8ë¯¸í„° (ì¡°ê¸ˆ ë” ë©€ë¦¬ ë„ì›€)
            const spawnPos = {
                x: pos.x - Math.sin(angle) * 0.8,
                y: pos.y, 
                z: pos.z - Math.cos(angle) * 0.8
            };

            const randomColor = colors[Math.floor(Math.random() * colors.length)];

            // ğŸ’¥ 1. ìˆ˜ì œ íŒŒí‹°í´ í­ë°œ ì‹¤í–‰
            createExplosion(spawnPos, randomColor);

            // ğŸ‘» 2. ì •ë ¹(Wisp) ë³¸ì²´ ìƒì„±
            const wisp = document.createElement('a-entity');
            wisp.setAttribute('position', spawnPos);
            wisp.setAttribute('look-at-camera', ''); // ë‚˜ë¥¼ ì³ë‹¤ë´„

            // (A) ë¹›ë‚˜ëŠ” í•µ
            const core = document.createElement('a-sphere');
            core.setAttribute('radius', '0.06');
            core.setAttribute('material', `color: ${randomColor}; shader: flat; transparent: true; opacity: 0.8`);
            // ê³ ë™ì¹˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
            core.setAttribute('animation', 'property: scale; from: 1 1 1; to: 1.5 1.5 1.5; dir: alternate; loop: true; dur: 500');
            wisp.appendChild(core);

            // (B) íšŒì „í•˜ëŠ” ê³ ë¦¬ 1
            const ring1 = document.createElement('a-torus');
            ring1.setAttribute('radius', '0.12');
            ring1.setAttribute('radius-tubular', '0.005');
            ring1.setAttribute('material', `color: white; opacity: 0.5; transparent: true`);
            ring1.setAttribute('animation', 'property: rotation; to: 360 360 0; loop: true; dur: 2000; easing: linear');
            wisp.appendChild(ring1);

            // (C) íšŒì „í•˜ëŠ” ê³ ë¦¬ 2 (ë°˜ëŒ€ ë°©í–¥)
            const ring2 = document.createElement('a-torus');
            ring2.setAttribute('radius', '0.18');
            ring2.setAttribute('radius-tubular', '0.002');
            ring2.setAttribute('material', `color: ${randomColor}; opacity: 0.3; transparent: true`);
            ring2.setAttribute('animation', 'property: rotation; to: -360 0 -360; loop: true; dur: 4000; easing: linear');
            wisp.appendChild(ring2);

            // (D) ë‘¥ë‘¥ ë– ìˆëŠ” ì›€ì§ì„
            wisp.setAttribute('animation__float', `property: position; to: ${spawnPos.x} ${spawnPos.y + 0.1} ${spawnPos.z}; dir: alternate; loop: true; dur: 1500; easing: easeInOutSine`);

            // ìƒì„± ì‹œ ì‘ê²Œ ì‹œì‘í•´ì„œ ì»¤ì§ (Pop íš¨ê³¼)
            wisp.setAttribute('scale', '0 0 0');
            wisp.setAttribute('animation__pop', 'property: scale; to: 1 1 1; dur: 600; easing: easeOutElastic');

            scene.appendChild(wisp);

            // ì•ˆë‚´ ë¬¸êµ¬ ì—…ë°ì´íŠ¸
            const ui = document.querySelector('.btn-text');
            ui.innerText = `âœ¨ ${randomColor} ì •ë ¹ ì†Œí™˜ë¨!`;
            ui.style.color = randomColor;
            ui.style.borderColor = randomColor;
        });
    </script>
</body>
</html>

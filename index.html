<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR Debugger</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        /* ë°°ê²½ íˆ¬ëª…í™” (ì¹´ë©”ë¼ ë³´ì„ í•„ìˆ˜ ì„¤ì •) */
        html, body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: transparent !important;
            font-family: 'Segoe UI', sans-serif;
        }

        /* 1. ì‹œì‘ í™”ë©´ (ê²€ì€ìƒ‰) */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white;
        }

        .btn-ar {
            background: #00E676; border: none; padding: 20px 40px;
            font-size: 20px; font-weight: bold; color: white; border-radius: 40px;
            margin-top: 20px; cursor: pointer; box-shadow: 0 0 15px #00E676;
        }
        .btn-ar:active { transform: scale(0.95); }

        /* 2. ê²Œì„ UI (AR ìœ„ì— ëœ¸) */
        #ar-ui {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
            flex-direction: column; justify-content: space-between; padding: 20px;
        }
        
        /* ìƒíƒœì°½ */
        .hud-box {
            background: rgba(0,0,0,0.6); padding: 15px; border-radius: 10px;
            color: white; pointer-events: auto; align-self: center; width: 90%;
            border: 1px solid rgba(255,255,255,0.2); margin-bottom: 20px;
        }

        /* í…ŒìŠ¤íŠ¸ ë²„íŠ¼ */
        .test-btn {
            pointer-events: auto; background: white; color: black; border: none;
            padding: 10px; border-radius: 5px; font-weight: bold; align-self: flex-end;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="margin:0;">LifeGo AR</h1>
        <p style="color:#aaa;">ì§„ë‹¨ ëª¨ë“œ (Debug Mode)</p>
        
        <button class="btn-ar" onclick="forceStartAR()">AR ëª¨ë“œ ì‹œì‘</button>
        
        <div id="log-msg" style="margin-top:20px; color:red; font-size:12px; max-width:80%; text-align:center;"></div>
    </div>

    <div id="ar-ui">
        <button class="test-btn" onclick="spawnText()">ğŸ“¸ ì²­ì†Œ ê°ì§€ (í…ŒìŠ¤íŠ¸)</button>
        <div class="hud-box">
            <h2 style="margin:0; font-size:24px;">LV.46</h2>
            <div style="background:#333; height:10px; margin-top:5px; border-radius:5px;">
                <div id="xp-bar" style="background:#00E676; width:45%; height:100%; border-radius:5px;"></div>
            </div>
            <p style="margin:5px 0 0 0; font-size:12px;">XP: 45 / 100</p>
        </div>
    </div>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; overlayElement: #ar-ui; requiredFeatures: hit-test;"
        vr-mode-ui="enabled: false"
        ar-mode-ui="enabled: true; enterAREnabled: true;"
        renderer="alpha: true; antialias: true;">
        
        <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>
        <a-light type="ambient" intensity="1"></a-light>
        <a-entity id="world"></a-entity>
    </a-scene>

    <script>
        // --- [ì§„ë‹¨] ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ ---
        async function forceStartAR() {
            const logBox = document.getElementById('log-msg');
            const scene = document.querySelector('a-scene');

            logBox.innerText = "AR ì„¸ì…˜ ìš”ì²­ ì¤‘...";

            // 1. ë¸Œë¼ìš°ì €ê°€ WebXRì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
            if (!navigator.xr) {
                alert("âŒ ì˜¤ë¥˜: ì´ ë¸Œë¼ìš°ì €ëŠ” WebXRì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n(ì•„ì´í°ì€ 'WebXR Viewer' ì•± í•„ìš”, ì•ˆë“œë¡œì´ë“œëŠ” í¬ë¡¬ ì‚¬ìš© ê¶Œì¥)");
                logBox.innerText = "WebXR ë¯¸ì§€ì› ë¸Œë¼ìš°ì €";
                return;
            }

            // 2. 'immersive-ar' (ì¹´ë©”ë¼ ëª¨ë“œ) ì§€ì› ì—¬ë¶€ í™•ì¸
            try {
                const isSupported = await navigator.xr.isSessionSupported('immersive-ar');
                if (!isSupported) {
                    alert("âŒ ì˜¤ë¥˜: ì´ ê¸°ê¸°ëŠ” 'AR ëª¨ë“œ'ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n(Google Play AR ì„œë¹„ìŠ¤ ì„¤ì¹˜ í™•ì¸ í•„ìš”)");
                    logBox.innerText = "ê¸°ê¸°ê°€ AR ëª¨ë“œ ë¯¸ì§€ì›";
                    return;
                }
            } catch (e) {
                alert("âŒ HTTPS ì˜¤ë¥˜ ê°€ëŠ¥ì„±: " + e.message + "\n(ë°˜ë“œì‹œ https:// ì£¼ì†Œì—¬ì•¼ í•©ë‹ˆë‹¤)");
                return;
            }

            // 3. ì§€ì›í•œë‹¤ë©´ ê°•ì œ ì§„ì… ì‹œë„
            try {
                // A-Frameì€ í•¨ìˆ˜ ì´ë¦„ì´ enterVRì´ì§€ë§Œ, ì„¤ì •(ar-mode-ui)ì— ë”°ë¼ ARë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.
                scene.enterVR(); 
                
                // UI ì „í™˜
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('ar-ui').style.display = 'flex';
            } catch (e) {
                alert("âŒ ì§„ì… ì‹¤íŒ¨: " + e);
            }
        }

        // --- 3D í…ìŠ¤íŠ¸ ë¡œì§ ---
        function spawnText() {
            const el = document.createElement('a-entity');
            const cam = document.querySelector('a-camera');
            const pos = cam.object3D.position;
            const dir = new THREE.Vector3(0,0,-1.5).applyQuaternion(cam.object3D.quaternion);

            el.setAttribute('position', {x:pos.x+dir.x, y:pos.y+dir.y, z:pos.z+dir.z});
            el.setAttribute('look-at', '[camera]');
            el.innerHTML = `<a-text value="Cleaning..." align="center" scale="2 2 2"></a-text>`;
            
            document.getElementById('world').appendChild(el);
            setTimeout(() => el.remove(), 2000);
            
            // ê²Œì´ì§€ ì¦ê°€
            const bar = document.getElementById('xp-bar');
            let w = parseInt(bar.style.width) || 0;
            bar.style.width = (w + 10) + '%';
        }
    </script>
</body>
</html>

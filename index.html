<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo Universal AR</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }

        /* [1] ì‹¤ì œ ì¹´ë©”ë¼ ì˜ìƒì´ ë‚˜ì˜¬ ë°°ê²½ ë¹„ë””ì˜¤ */
        #camera-feed {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover; /* í™”ë©´ ê½‰ ì°¨ê²Œ */
            z-index: 1; /* ì œì¼ ë’¤ */
            transform: scaleX(-1); /* ê±°ìš¸ëª¨ë“œ (ì…€ì¹´) ë°©ì§€ìš©, í›„ë©´ì¹´ë©”ë¼ëŠ” JSë¡œ ì œì–´ */
        }

        /* [2] A-Frame 3D ë ˆì´ì–´ */
        #scene-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2; /* ë¹„ë””ì˜¤ ìœ„ */
        }

        /* [3] UI ë ˆì´ì–´ (HUD) */
        #ui-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 3; /* ì œì¼ ìœ„ */
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 20px; box-sizing: border-box;
        }

        /* ì‹œì‘ ë²„íŠ¼ */
        #start-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white;
        }
        .btn-start {
            background: #00E676; border: none; padding: 15px 40px; border-radius: 50px;
            font-size: 20px; font-weight: bold; color: white; margin-top: 20px; cursor: pointer;
        }

        /* ê²Œì„ UI ìŠ¤íƒ€ì¼ */
        .hud-box {
            pointer-events: auto; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            padding: 15px; border-radius: 10px; color: white; border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-action {
            pointer-events: auto; background: rgba(0,255,100,0.2); border: 1px solid #00E676; 
            color: #00E676; padding: 8px 15px; border-radius: 8px; font-weight: bold; margin-bottom: 10px;
        }
        .xp-bar-bg { width: 100%; height: 8px; background: #555; border-radius: 4px; margin-top: 5px; }
        .xp-bar-fill { width: 0%; height: 100%; background: #00E676; transition: width 0.3s; }
    </style>
</head>
<body>

    <video id="camera-feed" autoplay playsinline muted></video>

    <div id="start-overlay">
        <h1>LifeGo AR</h1>
        <p>ì¹´ë©”ë¼ ê°•ì œ ì—°ê²° ëª¨ë“œ</p>
        <button class="btn-start" onclick="startCamera()">ì¹´ë©”ë¼ ì¼œê¸°</button>
        <p style="color:red; font-size:12px; margin-top:20px;" id="error-msg"></p>
    </div>

    <div id="ui-layer" style="display:none;">
        <div style="align-self: flex-end; display:flex; flex-direction:column; align-items:flex-end;">
            <button class="btn-action" onclick="spawn3DText('cleaning')">ğŸ§¹ ì²­ì†Œí•˜ê¸°</button>
            <button class="btn-action" onclick="spawn3DText('dishes')">ğŸ½ï¸ ì„¤ê±°ì§€</button>
        </div>

        <div class="hud-box" style="width: 100%; max-width: 400px; align-self: center;">
            <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                <span style="font-size:24px; font-weight:bold;">LV.<span id="lvl">46</span></span>
                <span>XP <span id="cur">0</span>/100</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="bar"></div></div>
        </div>
    </div>

    <div id="scene-container">
        <a-scene embedded vr-mode-ui="enabled: false" renderer="alpha: true; antialias: true;">
            <a-camera position="0 1.6 0" look-controls="enabled: true"></a-camera>
            
            <a-light type="ambient" intensity="0.8"></a-light>
            <a-light type="directional" intensity="0.8" position="-1 2 1"></a-light>
            
            <a-entity id="world"></a-entity>
        </a-scene>
    </div>

    <script>
        // --- [í•µì‹¬] ì¹´ë©”ë¼ ê°•ì œ ì—°ê²° í•¨ìˆ˜ ---
        async function startCamera() {
            const video = document.getElementById('camera-feed');
            const overlay = document.getElementById('start-overlay');
            const ui = document.getElementById('ui-layer');
            const errBox = document.getElementById('error-msg');

            try {
                // í›„ë©´ ì¹´ë©”ë¼ ìš”ì²­ (environment)
                const constraints = { 
                    video: { facingMode: "environment" }, 
                    audio: false 
                };
                
                // ë¸Œë¼ìš°ì € í‘œì¤€ API ì‚¬ìš© (WebXR ì•„ë‹˜)
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                // UI ì „í™˜
                overlay.style.display = 'none';
                ui.style.display = 'flex';

            } catch (err) {
                console.error(err);
                errBox.innerText = "ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: " + err.message + "\n(ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í–ˆë‚˜ìš”?)";
                alert("ì¹´ë©”ë¼ë¥¼ ì¼¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. " + err.message);
            }
        }

        // --- ê²Œì„ ë¡œì§ (ì´ì „ê³¼ ë™ì¼) ---
        let xp = 0; let lv = 46;

        function spawn3DText(type) {
            const title = type === 'cleaning' ? "Vacuuming" : "Washing Dishes";
            const val = type === 'cleaning' ? 15 : 20;

            const el = document.createElement('a-entity');
            const cam = document.querySelector('a-camera');
            
            // ì¹´ë©”ë¼ê°€ ë³´ëŠ” ë°©í–¥ ê°€ì ¸ì˜¤ê¸°
            const pos = cam.object3D.position;
            const dir = new THREE.Vector3(0, 0, -2).applyQuaternion(cam.object3D.quaternion);

            el.setAttribute('position', {x: pos.x + dir.x, y: pos.y + dir.y, z: pos.z + dir.z});
            el.setAttribute('look-at', '[camera]');
            
            el.innerHTML = `
                <a-text value="${title}" align="center" position="0 0.2 0" scale="2 2 2" color="white"></a-text>
                <a-plane color="#00E676" width="0.8" height="0.3">
                    <a-text value="+${val} XP" align="center" color="black" z-offset="0.01" scale="2 2 2"></a-text>
                </a-plane>
            `;

            document.getElementById('world').appendChild(el);
            
            // ì• ë‹ˆë©”ì´ì…˜
            el.setAttribute('animation', `property: position; to: ${pos.x + dir.x} ${pos.y + dir.y + 0.5} ${pos.z + dir.z}; dur: 1500; easing: easeOutQuad`);
            setTimeout(() => el.remove(), 1500);

            // XP ì¦ê°€
            xp += val;
            if (xp >= 100) { xp -= 100; lv++; }
            document.getElementById('lvl').innerText = lv;
            document.getElementById('cur').innerText = xp;
            document.getElementById('bar').style.width = xp + "%";
        }
    </script>
</body>
</html>

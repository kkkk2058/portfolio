<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Hybrid Input AR</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
        #ui-layer {
            position: absolute; bottom: 30px; width: 100%; text-align: center; z-index: 10; pointer-events: none;
        }
        .btn-text {
            background: rgba(0, 0, 0, 0.6); color: #00ff00; padding: 15px 30px; border-radius: 30px;
            font-family: sans-serif; font-weight: bold; font-size: 18px; border: 2px solid #00ff00;
        }
    </style>
</head>
<body>
    <div id="ui-layer"><span class="btn-text">ğŸ‘‡ í™”ë©´ì„ ê¾¹ ëˆŒëŸ¬ë³´ì„¸ìš”!</span></div>

    <a-scene 
        cursor="rayOrigin: mouse" 
        raycaster="objects: none"
        xr-mode-ui="enabled: true; enterAREnabled: true; XRMode: ar">

        <a-camera position="0 1.6 0"></a-camera>

        <a-light type="directional" position="1 4 2" intensity="0.8"></a-light>
        <a-light type="ambient" intensity="0.4"></a-light>

    </a-scene>

    <script>
        // ë‚˜ë¥¼ ì³ë‹¤ë³´ëŠ” ì»´í¬ë„ŒíŠ¸
        AFRAME.registerComponent('look-at-camera', {
            tick: function () {
                if (!this.el.sceneEl.camera) return;
                this.el.object3D.lookAt(this.el.sceneEl.camera.el.object3D.position);
            }
        });

        const scene = document.querySelector('a-scene');
        const uiText = document.querySelector('.btn-text');

        // ğŸ’¥ ì†Œí™˜ ë¡œì§ (í•¨ìˆ˜ë¡œ ë¶„ë¦¬)
        function spawnMagic(e) {
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€ (í„°ì¹˜ì™€ í´ë¦­ì´ ë™ì‹œì— ëœ° ê²½ìš° ëŒ€ë¹„)
            // ìµœê·¼ ì‹¤í–‰ ì‹œê°„ì´ 0.2ì´ˆ ì´ë‚´ë©´ ë¬´ì‹œ
            const now = Date.now();
            if (spawnMagic.lastTime && (now - spawnMagic.lastTime < 200)) return;
            spawnMagic.lastTime = now;

            // --- ìœ„ì¹˜ ê³„ì‚° ---
            const camera = document.querySelector('a-camera');
            const pos = camera.getAttribute('position');
            const rot = camera.getAttribute('rotation');
            const angle = rot.y * (Math.PI / 180);
            
            // ëˆˆì• 0.8ë¯¸í„°
            const spawnPos = {
                x: pos.x - Math.sin(angle) * 0.8,
                y: pos.y, 
                z: pos.z - Math.cos(angle) * 0.8
            };

            // --- ì •ë ¹ ìƒì„± ---
            const wisp = document.createElement('a-entity');
            wisp.setAttribute('position', spawnPos);
            wisp.setAttribute('look-at-camera', '');

            // ëœë¤ ìƒ‰ìƒ
            const color = '#' + Math.floor(Math.random()*16777215).toString(16);

            // í•µ (Sphere)
            const core = document.createElement('a-sphere');
            core.setAttribute('radius', '0.1');
            core.setAttribute('material', `color: ${color}; opacity: 0.8; transparent: true`);
            core.setAttribute('animation', 'property: scale; from: 0.8 0.8 0.8; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 400');
            wisp.appendChild(core);

            // ê³ ë¦¬ (Ring)
            const ring = document.createElement('a-torus');
            ring.setAttribute('radius', '0.2');
            ring.setAttribute('radius-tubular', '0.01');
            ring.setAttribute('material', `color: white; opacity: 0.5; transparent: true`);
            ring.setAttribute('animation', 'property: rotation; to: 360 360 0; loop: true; dur: 2000; easing: linear');
            wisp.appendChild(ring);

            // ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜
            wisp.setAttribute('scale', '0 0 0');
            wisp.setAttribute('animation__pop', 'property: scale; to: 1 1 1; dur: 500; easing: easeOutBack');

            scene.appendChild(wisp);
            
            uiText.innerText = "âœ¨ ì†Œí™˜ ì„±ê³µ!";
            uiText.style.color = color;
            uiText.style.borderColor = color;
        }

        // âœ… í•µì‹¬ ìˆ˜ì • ì‚¬í•­: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ì¤‘ ë“±ë¡
        
        // 1. PCìš© í´ë¦­
        window.addEventListener('click', spawnMagic);

        // 2. ëª¨ë°”ì¼ìš© í„°ì¹˜ (touchstart)
        // 'touchstart'ëŠ” ì†ê°€ë½ì´ ë‹¿ìë§ˆì ë°œìƒí•˜ë¯€ë¡œ ë°˜ì‘ì´ ê°€ì¥ ë¹ ë¦…ë‹ˆë‹¤.
        window.addEventListener('touchstart', spawnMagic);

    </script>
</body>
</html>

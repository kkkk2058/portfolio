<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR Complete</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }

        /* --- 1. ì»¤ìŠ¤í…€ ì‹œì‘ í™”ë©´ (Start Screen) --- */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.95);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            transition: opacity 0.5s ease;
        }

        .ar-btn-main {
            background: linear-gradient(135deg, #00e676, #00c853);
            border: none;
            padding: 18px 40px;
            font-size: 22px;
            font-weight: 800;
            color: white;
            border-radius: 50px;
            box-shadow: 0 0 25px rgba(0, 230, 118, 0.5);
            cursor: pointer;
            letter-spacing: 1px;
            margin-top: 30px;
            transition: transform 0.2s;
        }
        .ar-btn-main:active { transform: scale(0.95); }

        /* --- 2. ê²Œì„ UI (HUD) - ì²˜ìŒì—” ìˆ¨ê¹€ --- */
        #ar-ui {
            display: none; /* ì‹œì‘ ì „ì—” ì•ˆë³´ì„ */
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 100;
            flex-direction: column;
            justify-content: space-between; /* ìœ„ì•„ë˜ ë¶„ë°° */
            padding: 20px;
            box-sizing: border-box;
        }

        /* í…ŒìŠ¤íŠ¸ìš© ì‹œë®¬ë ˆì´ì…˜ ë²„íŠ¼ë“¤ (ìƒë‹¨) */
        #sim-controls {
            align-self: flex-end;
            pointer-events: auto;
            display: flex; flex-direction: column; gap: 10px;
            margin-top: 10px;
        }
        .sim-btn {
            background: rgba(0, 0, 0, 0.6); 
            border: 1px solid #00e676;
            color: #00e676;
            padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold;
            backdrop-filter: blur(4px);
        }
        .sim-btn:active { background: rgba(0, 230, 118, 0.3); }

        /* í”Œë ˆì´ì–´ ìƒíƒœì°½ (í•˜ë‹¨) */
        .player-stats {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            width: 100%; 
            max-width: 400px;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
            pointer-events: auto;
            align-self: center; /* ì¤‘ì•™ ì •ë ¬ */
            margin-bottom: 20px;
        }

        .level-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .level-badge { font-size: 20px; font-weight: 800; }
        .xp-val { font-size: 14px; opacity: 0.8; }
        
        /* ê²½í—˜ì¹˜ ë°” */
        .xp-track {
            width: 100%; height: 8px; background: rgba(255,255,255,0.2);
            border-radius: 4px; overflow: hidden;
        }
        .xp-fill {
            height: 100%; background: #00e676;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 10px #00e676;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="margin:0; font-size:32px;">LifeGo AR</h1>
        <p style="opacity:0.7; margin-top:5px;">Gamify Your Daily Chores</p>
        <button class="ar-btn-main" onclick="startAR()">START MISSION</button>
        <p style="font-size:12px; margin-top:20px; opacity:0.5;">*HTTPS & Mobile/Headset Required</p>
    </div>

    <div id="ar-ui">
        <div id="sim-controls">
            <button class="sim-btn" onclick="triggerDetection('washing_dishes')">ğŸ“¸ ì„¤ê±°ì§€ (+20 XP)</button>
            <button class="sim-btn" onclick="triggerDetection('vacuuming')">ğŸ§¹ ì²­ì†Œ (+15 XP)</button>
        </div>

        <div class="player-stats">
            <div class="level-row">
                <span class="level-badge">LV.<span id="lvl-num">46</span></span>
                <span class="xp-val"><span id="xp-cur">0</span> / <span id="xp-max">100</span> XP</span>
            </div>
            <div class="xp-track">
                <div class="xp-fill" id="xp-bar" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; overlayElement: #ar-ui; requiredFeatures: hit-test;"
        vr-mode-ui="enabled: false"
        ar-mode-ui="enabled: true; enterAREnabled: true;"
        renderer="alpha: true; antialias: true;">

        <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>
        
        <a-light type="ambient" intensity="0.6"></a-light>
        <a-light type="directional" intensity="0.8" position="-0.5 1 1"></a-light>

        <a-entity id="floating-text-container"></a-entity>
    </a-scene>

    <script>
        // --- [Logic 1] ê²Œì„ ë°ì´í„° (ìƒíƒœ ê´€ë¦¬) ---
        let currentXP = 45;
        let maxXP = 100;
        let currentLevel = 46;

        // í™œë™ ë°ì´í„°ë² ì´ìŠ¤
        const ACTIVITY_DB = {
            'washing_dishes': { label: 'Washing Dishes', xp: 20 },
            'vacuuming': { label: 'Vacuuming', xp: 15 }
        };

        // --- [Logic 2] AR ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ ---
        function startAR() {
            const scene = document.querySelector('a-scene');
            const startScreen = document.getElementById('start-screen');
            const gameUI = document.getElementById('ar-ui');

            // 1. WebXR AR ëª¨ë“œ ì§„ì…
            scene.enterVR();

            // 2. UI ì „í™˜ (Start Screen ìˆ¨ê¹€ -> HUD ë³´ì„)
            startScreen.style.opacity = '0';
            setTimeout(() => {
                startScreen.style.display = 'none';
                gameUI.style.display = 'flex';
                // ì´ˆê¸° HUD ì—…ë°ì´íŠ¸
                updateHUD();
            }, 500);
        }

        // --- [Logic 3] 3D í”Œë¡œíŒ… í…ìŠ¤íŠ¸ ìƒì„± ---
        function spawnFloatingText(activityKey) {
            const data = ACTIVITY_DB[activityKey];
            const container = document.getElementById('floating-text-container');
            const camera = document.querySelector('a-camera');

            // 3D ì—”í‹°í‹° ìƒì„±
            const entity = document.createElement('a-entity');
            
            // ìœ„ì¹˜ ê³„ì‚°: ì¹´ë©”ë¼ê°€ ë°”ë¼ë³´ëŠ” ë°©í–¥ 1.5m ì•
            const p = camera.object3D.position;
            const dir = new THREE.Vector3(0, 0, -1.5).applyQuaternion(camera.object3D.quaternion);
            entity.setAttribute('position', {x: p.x + dir.x, y: p.y + dir.y, z: p.z + dir.z});
            
            // â˜… ì¤‘ìš”: í…ìŠ¤íŠ¸ê°€ í•­ìƒ ì‚¬ìš©ìë¥¼ ë°”ë¼ë´„
            entity.setAttribute('look-at', '[camera]');

            // í…ìŠ¤íŠ¸ (ì œëª©)
            const text = document.createElement('a-text');
            text.setAttribute('value', data.label);
            text.setAttribute('align', 'center');
            text.setAttribute('position', '0 0.15 0');
            text.setAttribute('scale', '1.5 1.5 1.5');
            text.setAttribute('color', 'white');
            text.setAttribute('font', 'mozillavr');

            // XP ë±ƒì§€ (ë°°ê²½ + í…ìŠ¤íŠ¸)
            const xpEntity = document.createElement('a-entity');
            xpEntity.setAttribute('position', '0 0 -0.1'); // ì œëª© ë°”ë¡œ ì•„ë˜ë‚˜ ê²¹ì³ë³´ì´ê²Œ ì¡°ì • ê°€ëŠ¥
            
            // XP í…ìŠ¤íŠ¸ (ë…¹ìƒ‰)
            const xpText = document.createElement('a-text');
            xpText.setAttribute('value', `+${data.xp} XP`);
            xpText.setAttribute('color', '#00e676');
            xpText.setAttribute('align', 'center');
            xpText.setAttribute('position', '0.8 0.15 0'); // ì œëª© ì˜¤ë¥¸ìª½
            xpText.setAttribute('scale', '1.5 1.5 1.5');
            
            entity.appendChild(text);
            entity.appendChild(xpText);
            container.appendChild(entity);

            // ì• ë‹ˆë©”ì´ì…˜: ìœ„ë¡œ ë– ì˜¤ë¥´ê¸°
            entity.setAttribute('animation__pos', {
                property: 'position',
                to: `${entity.getAttribute('position').x} ${entity.getAttribute('position').y + 0.5} ${entity.getAttribute('position').z}`,
                dur: 2000,
                easing: 'easeOutQuad'
            });

            // ìë™ ì‚­ì œ
            setTimeout(() => {
                if(entity.parentNode) entity.parentNode.removeChild(entity);
            }, 2000);

            // ë°ì´í„° ë°˜ì˜
            addXP(data.xp);
        }

        // --- [Logic 4] ê²½í—˜ì¹˜ ë° ë ˆë²¨ ê³„ì‚° ---
        function addXP(amount) {
            currentXP += amount;
            
            // ë ˆë²¨ì—… ë¡œì§
            if (currentXP >= maxXP) {
                currentXP = currentXP - maxXP;
                currentLevel++;
                maxXP = Math.floor(maxXP * 1.1); // ë‹¤ìŒ ë ˆë²¨ í•„ìš” ê²½í—˜ì¹˜ ì¦ê°€
                
                // ë ˆë²¨ì—… ì‹œê°ì  í”¼ë“œë°±
                const lvlNum = document.getElementById('lvl-num');
                lvlNum.style.color = '#ffff00';
                lvlNum.style.transform = 'scale(1.5)';
                setTimeout(() => {
                    lvlNum.style.color = 'white';
                    lvlNum.style.transform = 'scale(1)';
                }, 500);
            }
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('lvl-num').innerText = currentLevel;
            document.getElementById('xp-cur').innerText = currentXP;
            document.getElementById('xp-max').innerText = maxXP;
            
            const pct = Math.min((currentXP / maxXP) * 100, 100);
            document.getElementById('xp-bar').style.width = `${pct}%`;
        }

        // --- ì™¸ë¶€ ì—°ë™ìš© í•¨ìˆ˜ ---
        function triggerDetection(key) {
            spawnFloatingText(key);
        }
        
        // ì´ˆê¸°í™”
        updateHUD();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR: v3.0 Ultimate</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- ê¸°ë³¸ ì„¤ì • --- */
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; user-select: none; }
        
        /* ì¹´ë©”ë¼ ë°°ê²½ */
        #camera-feed {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 1; transform: scaleX(-1);
        }

        /* UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 15px; box-sizing: border-box;
        }

        /* --- [UPGRADE] ìƒì  (Shop) ëª¨ë‹¬ --- */
        #shop-modal {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 85%; max-width: 400px;
            background: rgba(10, 20, 30, 0.95); border: 1px solid #00E676;
            border-radius: 15px; padding: 20px; z-index: 999; pointer-events: auto;
            box-shadow: 0 0 30px rgba(0,230,118,0.3); color: white;
        }
        .shop-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .shop-items { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-item {
            background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px;
            text-align: center; border: 1px solid transparent; transition: 0.2s; cursor: pointer;
        }
        .shop-item:hover { border-color: #00E676; background: rgba(0,230,118,0.1); }
        .item-icon { font-size: 30px; margin-bottom: 5px; display: block; }
        .item-price { color: #FFD700; font-weight: bold; font-size: 14px; }
        .close-btn { background: none; border: none; color: #aaa; font-size: 20px; cursor: pointer; }

        /* --- UI Components --- */
        .profile-panel {
            pointer-events: auto; background: rgba(0, 20, 40, 0.7); backdrop-filter: blur(10px);
            border-left: 4px solid #00E676; padding: 10px 15px; border-radius: 0 15px 15px 0;
            color: white; display: inline-flex; align-items: center; gap: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: #333 url('https://cdn-icons-png.flaticon.com/512/4140/4140048.png') center/cover; border: 2px solid white; }
        
        /* í€˜ìŠ¤íŠ¸ íŒ¨ë„ */
        .quest-panel { pointer-events: auto; margin-top: 10px; align-self: flex-end; width: 220px; }
        .quest-list { background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); padding: 10px; border-radius: 10px; color: white; border: 1px solid rgba(255,255,255,0.1); }
        .quest-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; align-items: center; }
        .quest-check { color: #00E676; margin-right: 5px; }
        .quest-item.done { text-decoration: line-through; opacity: 0.5; color: #aaa; }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
        .bottom-hud { width: 100%; display: flex; flex-direction: column; gap: 10px; }
        
        .action-row { pointer-events: auto; display: flex; justify-content: center; gap: 10px; }
        .btn-act {
            background: rgba(0,0,0,0.6); color: white; border: 1px solid #555;
            padding: 8px 15px; border-radius: 20px; font-size: 13px; cursor: pointer;
            display: flex; align-items: center; gap: 5px; backdrop-filter: blur(4px);
        }
        .btn-act:active { transform: scale(0.95); background: rgba(0,230,118,0.3); }

        .btn-shop { background: linear-gradient(135deg, #FFD700, #FFA000); color: black; border: none; font-weight: bold; }

        /* ìŠ¤íƒ¯ ë°” */
        .status-bar {
            pointer-events: auto; background: rgba(10, 10, 10, 0.85); backdrop-filter: blur(15px);
            border-radius: 15px; padding: 15px 20px; border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-top { display: flex; justify-content: space-between; align-items: flex-end; }
        .lvl { font-size: 28px; font-weight: 900; color: white; line-height: 1; }
        .coin { color: #FFD700; font-weight: bold; font-size: 16px; }
        
        .xp-track { width: 100%; height: 10px; background: #333; border-radius: 5px; margin-top: 8px; overflow: hidden; }
        .xp-fill { height: 100%; background: #00E676; width: 0%; transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 0 10px #00E676; }

        /* ì‹œì‘ í™”ë©´ */
        #start-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: #080808; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .btn-main { background: #00E676; border: none; padding: 18px 50px; border-radius: 50px; font-size: 20px; font-weight: bold; margin-top: 30px; cursor: pointer; box-shadow: 0 0 20px rgba(0,230,118,0.4); }
    </style>
</head>
<body>

    <audio id="sfx-coin" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="sfx-level" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
    <audio id="sfx-click" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3"></audio>

    <video id="camera-feed" autoplay playsinline muted></video>

    <div id="start-overlay">
        <h1 style="color:#00E676; font-size:40px; margin:0;">LIFEGO v3.0</h1>
        <p style="color:#aaa;">Gamification of Reality</p>
        <button class="btn-main" onclick="initApp()">SYSTEM START</button>
        <p id="save-msg" style="color:#FFD700; font-size:12px; margin-top:20px; display:none;">ğŸ’¾ ë°ì´í„° ë¡œë“œë¨</p>
    </div>

    <div id="shop-modal">
        <div class="shop-header">
            <span><i class="fas fa-shopping-cart"></i> REWARD SHOP</span>
            <button class="close-btn" onclick="toggleShop()"><i class="fas fa-times"></i></button>
        </div>
        <div style="text-align:right; margin-bottom:10px; color:#FFD700; font-weight:bold;">
            ë³´ìœ : <span id="shop-coin">0</span> G
        </div>
        <div class="shop-items">
            <div class="shop-item" onclick="buyItem('coffee', 500)">
                <span class="item-icon">â˜•</span>
                <div>ì»¤í”¼ í•œ ì”</div>
                <div class="item-price">500 G</div>
            </div>
            <div class="shop-item" onclick="buyItem('rest', 1000)">
                <span class="item-icon">ğŸ®</span>
                <div>30ë¶„ íœ´ì‹ê¶Œ</div>
                <div class="item-price">1,000 G</div>
            </div>
            <div class="shop-item" onclick="buyItem('snack', 300)">
                <span class="item-icon">ğŸ©</span>
                <div>ê°„ì‹ íƒ€ì„</div>
                <div class="item-price">300 G</div>
            </div>
            <div class="shop-item" onclick="buyItem('theme', 5000)">
                <span class="item-icon">ğŸ¨</span>
                <div>ê³¨ë“œ í…Œë§ˆ</div>
                <div class="item-price">5,000 G</div>
            </div>
        </div>
    </div>

    <div id="ui-layer" style="display:none;">
        <div style="display:flex; justify-content:space-between; width:100%;">
            <div class="profile-panel">
                <div class="user-avatar"></div>
                <div>
                    <div style="font-size:11px; color:#00E676;">PLAYER</div>
                    <div style="font-weight:bold;">SEHOON KIM</div>
                </div>
            </div>
            <div class="quest-panel">
                <div style="font-weight:bold; margin-bottom:5px; color:#00E676;">ğŸ“‹ QUESTS</div>
                <div class="quest-list" id="quest-list-ui"></div>
            </div>
        </div>

        <div class="bottom-hud">
            <div class="action-row">
                <button class="btn-act" onclick="completeAction('clean')"><i class="fas fa-broom"></i> ì²­ì†Œ</button>
                <button class="btn-act" onclick="completeAction('dish')"><i class="fas fa-soap"></i> ì„¤ê±°ì§€</button>
                <button class="btn-act btn-shop" onclick="toggleShop()"><i class="fas fa-store"></i> ìƒì </button>
            </div>

            <div class="status-bar">
                <div class="stat-top">
                    <div><span class="lvl">LV.<span id="ui-lvl">1</span></span></div>
                    <div class="coin"><i class="fas fa-coins"></i> <span id="ui-coin">0</span></div>
                </div>
                <div class="xp-track"><div class="xp-fill" id="ui-bar"></div></div>
                <div style="text-align:right; font-size:11px; color:#aaa; margin-top:3px;">
                    XP <span id="ui-cur">0</span> / <span id="ui-max">100</span>
                </div>
            </div>
        </div>
    </div>

    <div style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:5;">
        <a-scene embedded vr-mode-ui="enabled: false" renderer="alpha: true; antialias: true;">
            <a-camera position="0 1.6 0" look-controls="enabled: true"></a-camera>
            <a-light type="ambient" intensity="0.8"></a-light>
            <a-light type="directional" intensity="1" position="-1 2 1"></a-light>
            <a-entity id="world-space"></a-entity>
        </a-scene>
    </div>

    <script>
        // --- [UPGRADE] ì‚¬ìš´ë“œ ë§¤ë‹ˆì € ---
        const SFX = {
            coin: document.getElementById('sfx-coin'),
            level: document.getElementById('sfx-level'),
            click: document.getElementById('sfx-click'),
            play: (name) => {
                const sound = SFX[name];
                if(sound) { sound.currentTime = 0; sound.play().catch(e=>{}); }
            }
        };

        // --- ê²Œì„ ë°ì´í„° ---
        let game = {
            level: 1,
            xp: 0,
            maxXp: 100,
            coins: 0,
            quests: [
                { id: 'clean', title: 'ë°© ì²­ì†Œí•˜ê¸°', xp: 50, gold: 100, done: false },
                { id: 'dish', title: 'ì„¤ê±°ì§€ í•˜ê¸°', xp: 30, gold: 50, done: false }
            ]
        };

        // --- [UPGRADE] ë°ì´í„° ì €ì¥/ë¡œë“œ (LocalStorage) ---
        function loadData() {
            const saved = localStorage.getItem('lifego_save_v1');
            if (saved) {
                game = JSON.parse(saved);
                document.getElementById('save-msg').style.display = 'block';
            }
        }
        function saveData() {
            localStorage.setItem('lifego_save_v1', JSON.stringify(game));
        }

        // --- ì´ˆê¸°í™” ---
        async function initApp() {
            SFX.play('click');
            loadData(); // ë°ì´í„° ë¡œë“œ
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                document.getElementById('camera-feed').srcObject = stream;
                
                document.getElementById('start-overlay').style.display = 'none';
                document.getElementById('ui-layer').style.display = 'flex';
                updateUI();
            } catch (e) {
                alert("ì¹´ë©”ë¼ ê¶Œí•œ í•„ìˆ˜: " + e.message);
            }
        }

        // --- ì•¡ì…˜ ìˆ˜í–‰ ---
        function completeAction(type) {
            const quest = game.quests.find(q => q.id === type);
            if(!quest) return;

            // 1. íš¨ê³¼ìŒ
            SFX.play('coin');

            // 2. 3D íš¨ê³¼ (íŒŒí‹°í´ ëŠë‚Œ ì¶”ê°€)
            spawn3DEffect(quest.title, quest.xp, quest.gold);

            // 3. ë³´ìƒ
            game.xp += quest.xp;
            game.coins += quest.gold;
            quest.done = true; // í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì²˜ë¦¬ (ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ë°˜ë³µ ê°€ëŠ¥í•˜ê²Œ í•˜ë ¤ë©´ false ìœ ì§€)
            
            checkLevelUp();
            updateUI();
            saveData(); // ìë™ ì €ì¥
        }

        // --- ë ˆë²¨ì—… ì²´í¬ ---
        function checkLevelUp() {
            if (game.xp >= game.maxXp) {
                game.xp -= game.maxXp;
                game.level++;
                game.maxXp = Math.floor(game.maxXp * 1.2);
                SFX.play('level');
                
                // ë ˆë²¨ì—… ì‹œê° íš¨ê³¼ (ê°„ë‹¨)
                alert(`ğŸ‰ LEVEL UP! Lv.${game.level} ë‹¬ì„±!`);
            }
        }

        // --- UI ì—…ë°ì´íŠ¸ ---
        function updateUI() {
            document.getElementById('ui-lvl').innerText = game.level;
            document.getElementById('ui-coin').innerText = game.coins.toLocaleString();
            document.getElementById('shop-coin').innerText = game.coins.toLocaleString();
            document.getElementById('ui-cur').innerText = game.xp;
            document.getElementById('ui-max').innerText = game.maxXp;
            document.getElementById('ui-bar').style.width = Math.min((game.xp/game.maxXp)*100, 100) + "%";

            // í€˜ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            const list = document.getElementById('quest-list-ui');
            list.innerHTML = '';
            game.quests.forEach(q => {
                list.innerHTML += `
                    <div class="quest-item ${q.done ? 'done' : ''}">
                        <span><i class="fas ${q.done ? 'fa-check-circle' : 'fa-circle'} quest-check"></i> ${q.title}</span>
                        <span style="color:#FFD700; font-size:11px;">+${q.gold}G</span>
                    </div>`;
            });
        }

        // --- [UPGRADE] ìƒì  ë¡œì§ ---
        function toggleShop() {
            SFX.play('click');
            const modal = document.getElementById('shop-modal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        function buyItem(item, price) {
            if(game.coins >= price) {
                game.coins -= price;
                SFX.play('coin');
                alert("êµ¬ë§¤ ì™„ë£Œ! (ì‹¤ì œ ë³´ìƒìœ¼ë¡œ êµí™˜í•˜ì„¸ìš”)");
                updateUI();
                saveData();
            } else {
                alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            }
        }

        // --- [UPGRADE] í™”ë ¤í•œ 3D í…ìŠ¤íŠ¸ & ì½”ì¸ íš¨ê³¼ ---
        function spawn3DEffect(text, xp, gold) {
            const el = document.createElement('a-entity');
            const cam = document.querySelector('a-camera');
            const pos = cam.object3D.position;
            const dir = new THREE.Vector3(0, 0, -2).applyQuaternion(cam.object3D.quaternion);

            el.setAttribute('position', {x: pos.x + dir.x, y: pos.y + dir.y, z: pos.z + dir.z});
            el.setAttribute('look-at', '[camera]');

            // í…ìŠ¤íŠ¸ + íšŒì „í•˜ëŠ” ì½”ì¸ ëª¨ë¸(ì›í˜•) ì‹œë®¬ë ˆì´ì…˜
            el.innerHTML = `
                <a-text value="${text}" align="center" position="0 0.3 0" scale="2 2 2" color="#fff" font="mozillavr"></a-text>
                <a-entity position="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 2000">
                    <a-circle color="#FFD700" radius="0.15" position="-0.6 0 0.1"></a-circle>
                    <a-circle color="#FFD700" radius="0.15" position="0.6 0 0.1"></a-circle>
                </a-entity>
                <a-entity position="0 -0.2 0">
                    <a-plane color="#000" opacity="0.8" width="1.4" height="0.5"></a-plane>
                    <a-text value="+${xp} XP  +${gold} G" align="center" color="#00E676" scale="2.5 2.5 2.5" z-offset="0.01"></a-text>
                </a-entity>
            `;

            document.getElementById('world-space').appendChild(el);

            // ìœ„ë¡œ ë– ì˜¤ë¥´ë©° ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜
            el.setAttribute('animation', `property: position; to: ${pos.x + dir.x} ${pos.y + dir.y + 0.8} ${pos.z + dir.z}; dur: 1500; easing: easeOutQuad`);
            el.setAttribute('animation__scale', `property: scale; to: 0 0 0; delay: 1000; dur: 500;`);
            
            setTimeout(() => { if(el.parentNode) el.parentNode.removeChild(el); }, 1500);
        }
    </script>
</body>
</html>

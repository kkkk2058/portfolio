<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR: Quest & Level System</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        /* ê¸°ë³¸ í°íŠ¸ ë° ì„¤ì • */
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Roboto, Helvetica, sans-serif; }

        /* --- [1] ì‹œì‘ í™”ë©´ (Start Screen) --- */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #121212; /* ê²€ì€ ë°°ê²½ */
            z-index: 9999; /* ê°€ì¥ ìœ„ì— ëœ¸ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            transition: opacity 0.5s ease;
        }

        /* ì»¤ìŠ¤í…€ AR ì‹œì‘ ë²„íŠ¼ */
        .btn-start {
            background: linear-gradient(135deg, #00C853, #64DD17);
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            border-radius: 50px;
            box-shadow: 0 0 20px rgba(0, 200, 83, 0.6);
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-start:active { transform: scale(0.95); }

        /* --- [2] ì¸ê²Œì„ UI (HUD) --- */
        #ar-ui {
            display: none; /* ì‹œì‘ ì „ì—” ìˆ¨ê¹€ */
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* UI ë°°ê²½ì€ í´ë¦­ í†µê³¼ (3D ìƒí˜¸ì‘ìš© ìœ„í•´) */
            z-index: 100;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        /* ìƒë‹¨: ì‹œë®¬ë ˆì´ì…˜ ë²„íŠ¼ (ì‹¤ì œë¡  AIê°€ ìë™ ê°ì§€) */
        .sim-controls {
            align-self: flex-end; /* ìš°ì¸¡ ìƒë‹¨ ì •ë ¬ */
            pointer-events: auto; /* í´ë¦­ ê°€ëŠ¥í•˜ê²Œ */
            display: flex; flex-direction: column; gap: 10px;
        }
        .btn-test {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00E676;
            color: #00E676;
            padding: 8px 12px; border-radius: 8px;
            font-size: 14px; font-weight: bold; cursor: pointer;
            backdrop-filter: blur(4px);
        }

        /* í•˜ë‹¨: í”Œë ˆì´ì–´ ìƒíƒœì°½ (ë ˆë²¨, XP) */
        .player-hud {
            pointer-events: auto;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 100%; max-width: 400px;
            align-self: center; /* ì¤‘ì•™ í•˜ë‹¨ ì •ë ¬ */
            margin-bottom: 30px;
        }

        .hud-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; }
        .level-txt { font-size: 28px; font-weight: 900; color: #fff; line-height: 1; }
        .level-sub { font-size: 14px; color: #aaa; font-weight: normal; margin-left: 5px;}
        .xp-txt { font-size: 14px; color: #00E676; font-weight: bold; }

        /* XP ê²Œì´ì§€ ë°” */
        .xp-track { width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow: hidden; }
        .xp-fill {
            height: 100%; background: #00E676;
            width: 0%; /* JSë¡œ ë³€ê²½ë¨ */
            transition: width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 0 10px #00E676;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="margin: 0; font-size: 32px;">LifeGo AR</h1>
        <p style="color: #aaa; margin-top: 5px;">Gamify Your Daily Chores</p>
        <button class="btn-start" onclick="startAR()">START AR MISSION</button>
        <p style="font-size: 12px; color: #666; margin-top: 30px;">* Requires Camera Permission</p>
    </div>

    <div id="ar-ui">
        <div class="sim-controls">
            <button class="btn-test" onclick="triggerAction('washing_dishes')">ğŸ“¸ ì„¤ê±°ì§€ ê°ì§€ (+20 XP)</button>
            <button class="btn-test" onclick="triggerAction('vacuuming')">ğŸ§¹ ì²­ì†Œ ê°ì§€ (+15 XP)</button>
        </div>

        <div class="player-hud">
            <div class="hud-top">
                <div>
                    <span class="level-txt">LV.<span id="ui-level">46</span></span>
                    <span class="level-sub">User</span>
                </div>
                <div class="xp-txt"><span id="ui-xp-cur">0</span> / <span id="ui-xp-max">100</span> XP</div>
            </div>
            <div class="xp-track">
                <div class="xp-fill" id="ui-xp-bar"></div>
            </div>
        </div>
    </div>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; overlayElement: #ar-ui; requiredFeatures: hit-test;"
        vr-mode-ui="enabled: false"
        ar-mode-ui="enabled: true; enterAREnabled: true;"
        renderer="alpha: true; antialias: true; colorManagement: true;">

        <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>

        <a-light type="ambient" intensity="0.6"></a-light>
        <a-light type="directional" intensity="0.8" position="-1 2 1"></a-light>

        <a-entity id="floating-text-container"></a-entity>

    </a-scene>

    <script>
        // --- [Logic] ê²Œì„ ë°ì´í„° ---
        let level = 46;
        let currentXP = 45;
        let maxXP = 100;

        const ACTIVITIES = {
            'washing_dishes': { title: 'Washing Dishes', xp: 20 },
            'vacuuming': { title: 'Vacuuming', xp: 15 }
        };

        // --- [Logic] AR ì‹œì‘ í•¨ìˆ˜ ---
        function startAR() {
            const scene = document.querySelector('a-scene');
            const startScreen = document.getElementById('start-screen');
            const hud = document.getElementById('ar-ui');

            // 1. WebXR ì„¸ì…˜ ì‹œì‘ (ë¸Œë¼ìš°ì €ê°€ ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­í•¨)
            scene.enterVR(); 

            // 2. UI êµì²´ (ê²€ì€ í™”ë©´ -> íˆ¬ëª… HUD)
            startScreen.style.opacity = '0';
            setTimeout(() => {
                startScreen.style.display = 'none';
                hud.style.display = 'flex';
                updateHUD(); // ì´ˆê¸°ê°’ ë Œë”ë§
            }, 500);
        }

        // --- [Logic] 3D í”Œë¡œíŒ… í…ìŠ¤íŠ¸ ìƒì„± ---
        function triggerAction(actionKey) {
            const data = ACTIVITIES[actionKey];
            const container = document.getElementById('floating-text-container');
            const camera = document.querySelector('a-camera');

            // 1. ìœ„ì¹˜ ê³„ì‚° (ì¹´ë©”ë¼ ì •ë©´ 1.5m)
            const pos = camera.object3D.position;
            const dir = new THREE.Vector3(0, 0, -1.5).applyQuaternion(camera.object3D.quaternion);
            
            // 2. ì—”í‹°í‹° ìƒì„±
            const el = document.createElement('a-entity');
            el.setAttribute('position', { x: pos.x + dir.x, y: pos.y + dir.y, z: pos.z + dir.z });
            el.setAttribute('look-at', '[camera]'); // â˜… í…ìŠ¤íŠ¸ê°€ í•­ìƒ ë‚˜ë¥¼ ë´„

            // 3. í…ìŠ¤íŠ¸ êµ¬ì„± (HTML String ë°©ì‹ì´ ë” ê¹”ë”í•¨)
            el.innerHTML = `
                <a-text value="${data.title}" align="center" position="0 0.15 0" scale="1.5 1.5 1.5" color="white" font="mozillavr"></a-text>
                <a-entity position="0 -0.15 0">
                    <a-plane color="#00C853" width="0.8" height="0.3" opacity="0.9"></a-plane>
                    <a-text value="+${data.xp} XP" align="center" z-offset="0.01" scale="1.5 1.5 1.5"></a-text>
                </a-entity>
            `;
            
            container.appendChild(el);

            // 4. ì• ë‹ˆë©”ì´ì…˜ (ìœ„ë¡œ ë‘¥ë‘¥)
            el.setAttribute('animation', {
                property: 'position',
                to: `${pos.x + dir.x} ${pos.y + dir.y + 0.5} ${pos.z + dir.z}`,
                dur: 2000,
                easing: 'easeOutQuad'
            });

            // 5. ì‚­ì œ ë° ë°ì´í„° ì—…ë°ì´íŠ¸
            setTimeout(() => { if (el.parentNode) el.parentNode.removeChild(el); }, 2000);
            addXP(data.xp);
        }

        // --- [Logic] ê²½í—˜ì¹˜ ë° ë ˆë²¨ì—… ì‹œìŠ¤í…œ ---
        function addXP(amount) {
            currentXP += amount;
            if (currentXP >= maxXP) {
                currentXP -= maxXP;
                level++;
                maxXP = Math.floor(maxXP * 1.1); // ë‚œì´ë„ ìƒìŠ¹
                
                // ë ˆë²¨ì—… íš¨ê³¼
                const lvlText = document.querySelector('.level-txt');
                lvlText.style.color = '#FFD700'; // ê³¨ë“œìƒ‰
                setTimeout(() => lvlText.style.color = 'white', 1000);
            }
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('ui-level').innerText = level;
            document.getElementById('ui-xp-cur').innerText = currentXP;
            document.getElementById('ui-xp-max').innerText = maxXP;
            
            const pct = Math.min((currentXP / maxXP) * 100, 100);
            document.getElementById('ui-xp-bar').style.width = `${pct}%`;
        }
    </script>
</body>
</html>

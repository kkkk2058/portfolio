<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR Final</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        /* [ì¤‘ìš”] ë°°ê²½ íˆ¬ëª…í™”: ì¹´ë©”ë¼ê°€ ë³´ì´ê¸° ìœ„í•œ í•„ìˆ˜ ì„¤ì • */
        html, body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: transparent !important;
            font-family: 'Segoe UI', sans-serif;
        }

        /* 1. ì‹œì‘ í™”ë©´ */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white;
        }

        /* ì»¤ìŠ¤í…€ AR ë²„íŠ¼ */
        .btn-start {
            background: #00E676; border: none; padding: 20px 50px;
            font-size: 22px; font-weight: bold; color: white; border-radius: 50px;
            box-shadow: 0 0 20px rgba(0, 230, 118, 0.5); cursor: pointer;
            margin-top: 30px;
        }
        .btn-start:active { transform: scale(0.95); }

        /* 2. ê²Œì„ UI (AR ì§„ì… í›„ ë³´ì„) */
        #ar-ui {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
            flex-direction: column; justify-content: space-between; padding: 20px;
        }

        /* í…ŒìŠ¤íŠ¸ ë²„íŠ¼ (ìƒë‹¨) */
        .controls {
            pointer-events: auto; align-self: flex-end; display: flex; flex-direction: column; gap: 10px;
        }
        .btn-act {
            background: rgba(0,0,0,0.6); color: #00E676; border: 1px solid #00E676;
            padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer;
        }

        /* ìƒíƒœì°½ (í•˜ë‹¨) */
        .hud {
            pointer-events: auto; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            padding: 15px; border-radius: 15px; color: white; width: 100%; max-width: 400px;
            align-self: center; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);
        }
        .xp-bar { width: 100%; height: 8px; background: #555; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .xp-fill { width: 0%; height: 100%; background: #00E676; transition: width 0.3s; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1>LifeGo AR</h1>
        <p>í˜„ì‹¤ í€˜ìŠ¤íŠ¸ ì‹œìŠ¤í…œ</p>
        <button class="btn-start" onclick="activateAR()">AR ì‘ì „ ì‹œì‘</button>
        <p style="font-size:12px; color:#aaa; margin-top:20px;" id="status-msg">Ready</p>
    </div>

    <div id="ar-ui">
        <div class="controls">
            <button class="btn-act" onclick="doTask('clean')">ğŸ§¹ ì²­ì†Œ (+20 XP)</button>
            <button class="btn-act" onclick="doTask('dish')">ğŸ½ï¸ ì„¤ê±°ì§€ (+15 XP)</button>
        </div>
        <div class="hud">
            <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                <span style="font-size:24px; font-weight:bold;">LV.<span id="lvl">46</span></span>
                <span style="font-size:12px;">XP <span id="cur">0</span>/<span id="max">100</span></span>
            </div>
            <div class="xp-bar"><div class="xp-fill" id="bar"></div></div>
        </div>
    </div>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; overlayElement: #ar-ui; requiredFeatures: hit-test;"
        vr-mode-ui="enabled: false" 
        ar-mode-ui="enabled: true; enterAREnabled: true;"
        renderer="alpha: true; antialias: true;">
        
        <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>
        <a-light type="ambient" intensity="0.7"></a-light>
        <a-entity id="world"></a-entity>
    </a-scene>

    <script>
        let xp = 0;
        let max = 100;
        let lv = 46;

        // --- [í•µì‹¬] AR ê°•ì œ ì‹¤í–‰ í•¨ìˆ˜ ---
        async function activateAR() {
            const scene = document.querySelector('a-scene');
            const msg = document.getElementById('status-msg');

            msg.innerText = "AR ì„¸ì…˜ ìš”ì²­ ì¤‘...";

            // 1. ë¸Œë¼ìš°ì € ì§€ì› ì—¬ë¶€ ì²´í¬
            if (!navigator.xr) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” WebXRì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (í¬ë¡¬ ê¶Œì¥)");
                return;
            }

            try {
                // 2. AR ì„¸ì…˜ì´ ê°€ëŠ¥í•œì§€ í™•ì¸
                const supported = await navigator.xr.isSessionSupported('immersive-ar');
                if (!supported) {
                    alert("ì´ ê¸°ê¸°ëŠ” AR ëª¨ë“œ('immersive-ar')ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì•ˆë“œë¡œì´ë“œ: êµ¬ê¸€ í”Œë ˆì´ AR ì„œë¹„ìŠ¤ ì„¤ì¹˜ í•„ìš”\nì•„ì´í°: WebXR Viewer ì•± í•„ìš”");
                    return;
                }

                // 3. A-Frameì„ í†µí•´ AR ëª¨ë“œë¡œ ì§„ì… (VR UIë¥¼ ê»ìœ¼ë¯€ë¡œ ARë¡œ ì—°ê²°ë¨)
                scene.enterVR(); 

                // UI ì „í™˜
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('ar-ui').style.display = 'flex';

            } catch (err) {
                alert("AR ì‹¤í–‰ ì‹¤íŒ¨: " + err.message);
                msg.innerText = "Error: " + err.message;
            }
        }

        // --- ê²Œì„ ë¡œì§ ---
        function doTask(type) {
            const val = type === 'clean' ? 20 : 15;
            const title = type === 'clean' ? "Cleaning" : "Washing Dishes";
            
            // 3D í…ìŠ¤íŠ¸ ìƒì„±
            const el = document.createElement('a-entity');
            const cam = document.querySelector('a-camera');
            const pos = cam.object3D.position;
            // ì¹´ë©”ë¼ ì •ë©´ 1.5m
            const dir = new THREE.Vector3(0,0,-1.5).applyQuaternion(cam.object3D.quaternion);

            el.setAttribute('position', {x:pos.x+dir.x, y:pos.y+dir.y, z:pos.z+dir.z});
            el.setAttribute('look-at', '[camera]');
            el.innerHTML = `
                <a-text value="${title}" align="center" position="0 0.15 0" scale="1.5 1.5 1.5"></a-text>
                <a-plane color="#00E676" width="0.6" height="0.25">
                    <a-text value="+${val} XP" align="center" color="black" z-offset="0.01" scale="1.5 1.5 1.5"></a-text>
                </a-plane>
            `;
            document.getElementById('world').appendChild(el);

            // ì• ë‹ˆë©”ì´ì…˜
            el.setAttribute('animation', `property: position; to: ${pos.x+dir.x} ${pos.y+dir.y+0.5} ${pos.z+dir.z}; dur: 1500; easing: easeOutQuad`);
            setTimeout(()=> el.remove(), 1500);

            // XP ì¦ê°€
            xp += val;
            if(xp >= max) { xp -= max; lv++; max = Math.floor(max*1.1); }
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('lvl').innerText = lv;
            document.getElementById('cur').innerText = xp;
            document.getElementById('max').innerText = max;
            document.getElementById('bar').style.width = (xp/max*100) + "%";
        }
    </script>
</body>
</html>

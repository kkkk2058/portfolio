<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR Debug</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }

        /* [1] ÏãúÏûë ÌôîÎ©¥ & ÎîîÎ≤ÑÍ∑∏ Î°úÍ∑∏Ï∞Ω */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white;
        }

        #debug-log {
            width: 80%; height: 150px; background: rgba(0,0,0,0.8);
            border: 1px solid #555; overflow-y: scroll;
            margin-bottom: 20px; padding: 10px; font-size: 12px; font-family: monospace;
            color: #0f0; text-align: left;
        }

        .btn-start {
            background: #00E676; color: white; border: none;
            padding: 15px 40px; font-size: 20px; font-weight: bold;
            border-radius: 30px; cursor: pointer;
        }

        /* [2] Ïù∏Í≤åÏûÑ UI (Ïà®ÍπÄ ÏÉÅÌÉú) */
        #ar-ui {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
            flex-direction: column; justify-content: flex-end; padding: 20px;
        }

        .hud-box {
            background: rgba(0,0,0,0.6); color: white; padding: 15px; border-radius: 10px;
            pointer-events: auto; text-align: center; margin-bottom: 30px;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h2>AR System Check</h2>
        <div id="debug-log">Waiting for system check...<br></div>
        <button class="btn-start" onclick="forceStartAR()">START AR (FORCE)</button>
    </div>

    <div id="ar-ui">
        <div class="hud-box">
            <h3>LV. 46</h3>
            <p>UI Overlay Active</p>
            <button onclick="spawnTestObject()" style="padding:10px; background:white; color:black; border:none; border-radius:5px;">
                üì∏ Test Object
            </button>
        </div>
    </div>

    <a-scene 
        id="scene"
        webxr="optionalFeatures: dom-overlay, hit-test; overlayElement: #ar-ui; referenceSpaceType: local;"
        vr-mode-ui="enabled: false"
        ar-mode-ui="enabled: true; enterAREnabled: true;"
        renderer="alpha: true; antialias: true;">

        <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>
        <a-light type="ambient" intensity="1"></a-light>
        <a-entity id="world-root"></a-entity>

    </a-scene>

    <script>
        // --- [Ïú†Ìã∏] ÌôîÎ©¥Ïóê Î°úÍ∑∏ Ï∞çÍ∏∞ ---
        function log(msg, type='info') {
            const box = document.getElementById('debug-log');
            const line = document.createElement('div');
            line.innerText = `[${type}] ${msg}`;
            if(type === 'error') line.style.color = 'red';
            if(type === 'warn') line.style.color = 'yellow';
            box.appendChild(line);
            console.log(msg);
        }

        // --- [ÏßÑÎã® 1] ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú HTTPS Î∞è WebXR ÏßÄÏõê ÌôïÏù∏ ---
        window.onload = function() {
            log("System Loaded.");
            
            // 1. HTTPS Ï≤¥ÌÅ¨
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                log("CRITICAL: Not HTTPS! WebXR requires HTTPS.", 'error');
                alert("Ï£ºÏùò: HTTPS ÌôòÍ≤ΩÏù¥ ÏïÑÎãôÎãàÎã§. Ïπ¥Î©îÎùºÍ∞Ä ÏºúÏßÄÏßÄ ÏïäÏùÑ Ïàò ÏûàÏäµÎãàÎã§.");
            } else {
                log("HTTPS/Localhost Check OK.");
            }

            // 2. Î∏åÎùºÏö∞Ï†Ä WebXR ÏßÄÏõê Ï≤¥ÌÅ¨
            if ('xr' in navigator) {
                navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
                    if (supported) {
                        log("Device supports Immersive AR! Ready.", 'info');
                    } else {
                        log("Device does NOT support Immersive AR.", 'error');
                        log("Try Chrome on Android or WebXR Viewer on iOS.", 'warn');
                    }
                });
            } else {
                log("WebXR API not found in this browser.", 'error');
            }
        };

        // --- [ÌïµÏã¨] AR Í∞ïÏ†ú ÏãúÏûë Ìï®Ïàò ---
        function forceStartAR() {
            const scene = document.querySelector('a-scene');
            log("Attempting to enter AR mode...");

            try {
                // A-FrameÏùò VR/AR ÏßÑÏûÖ Î©îÏÑúÎìú Ìò∏Ï∂ú
                // ÏÑ§Ï†ïÏóê ar-mode-uiÍ∞Ä ÏºúÏ†∏ÏûàÏúºÎØÄÎ°ú ARÏùÑ Ïö∞ÏÑ† ÏãúÎèÑÌï©ÎãàÎã§.
                scene.enterVR(); 
                
                log("Request sent to Scene.");
                
                // UI Ï†ÑÌôò
                setTimeout(() => {
                    document.getElementById('start-screen').style.display = 'none';
                    document.getElementById('ar-ui').style.display = 'flex';
                }, 1000);
                
            } catch (e) {
                log("Error entering AR: " + e.message, 'error');
            }
        }

        // [ÌÖåÏä§Ìä∏] Ïò§Î∏åÏ†ùÌä∏ ÏÉùÏÑ±
        function spawnTestObject() {
            const root = document.getElementById('world-root');
            const cam = document.querySelector('a-camera');
            
            // Ïπ¥Î©îÎùº Ïïû 1m
            const pos = cam.object3D.position;
            const dir = new THREE.Vector3(0, 0, -1).applyQuaternion(cam.object3D.quaternion);

            const el = document.createElement('a-box');
            el.setAttribute('position', {x: pos.x + dir.x, y: pos.y + dir.y, z: pos.z + dir.z});
            el.setAttribute('color', 'red');
            el.setAttribute('scale', '0.2 0.2 0.2');
            el.setAttribute('look-at', '[camera]');
            
            root.appendChild(el);
            log("Object Spawned at " + Math.round(pos.x));
        }
    </script>
</body>
</html>

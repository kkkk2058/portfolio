<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LifeGo AR Complete</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>

    <style>
        /* [í•µì‹¬] ë°°ê²½ì„ íˆ¬ëª…í•˜ê²Œ ì„¤ì •í•´ì•¼ ì¹´ë©”ë¼ê°€ ë³´ì…ë‹ˆë‹¤ */
        html, body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: transparent !important;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        /* 1. ì‹œì‘ í™”ë©´ (ê²€ì€ ë°°ê²½) */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; transition: opacity 0.5s;
        }

        .btn-start {
            background: linear-gradient(135deg, #00C853, #64DD17);
            border: none; padding: 18px 40px; border-radius: 50px;
            font-size: 22px; font-weight: bold; color: white;
            box-shadow: 0 0 20px rgba(0, 200, 83, 0.5); cursor: pointer;
            margin-top: 20px;
        }

        /* 2. ê²Œì„ UI ë ˆì´ì–´ (AR ìœ„ì— ëœ¸) */
        #ar-ui {
            display: none; /* ì‹œì‘ ì „ì—” ìˆ¨ê¹€ */
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* ë°°ê²½ í„°ì¹˜ ë¬´ì‹œ (3D ì”¬ ì „ë‹¬) */
            z-index: 100;
            flex-direction: column; justify-content: space-between;
            padding: 20px; box-sizing: border-box;
        }

        /* ìƒë‹¨ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ (ë‚˜ì¤‘ì— Vision AIë¡œ ëŒ€ì²´) */
        .sim-controls {
            pointer-events: auto; align-self: flex-end;
            display: flex; flex-direction: column; gap: 10px;
        }
        .btn-action {
            background: rgba(0,0,0,0.6); border: 1px solid #00E676; color: #00E676;
            padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer;
            backdrop-filter: blur(5px);
        }

        /* í•˜ë‹¨ ìƒíƒœì°½ (ë ˆë²¨/XP) */
        .player-hud {
            pointer-events: auto;
            background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(10px);
            padding: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);
            color: white; margin-bottom: 30px;
            width: 100%; max-width: 400px; align-self: center;
        }

        .hud-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px; }
        .lvl-text { font-size: 24px; font-weight: 900; }
        .xp-text { font-size: 14px; color: #aaa; }
        
        /* XP ê²Œì´ì§€ */
        .xp-track { width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden; }
        .xp-fill {
            height: 100%; background: #00E676; width: 0%;
            transition: width 0.5s ease; box-shadow: 0 0 10px #00E676;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1>LifeGo AR</h1>
        <p>í˜„ì‹¤ í€˜ìŠ¤íŠ¸ ì‹œìŠ¤í…œ</p>
        <button class="btn-start" onclick="startAR()">ì‹œìŠ¤í…œ ê°€ë™ (START)</button>
        <p style="font-size:12px; color:#666; margin-top:30px;">* ì¹´ë©”ë¼ ê¶Œí•œ í—ˆìš© í•„ìˆ˜</p>
    </div>

    <div id="ar-ui">
        <div class="sim-controls">
            <button class="btn-action" onclick="triggerAction('vacuuming')">ğŸ§¹ ì²­ì†Œê¸° ëŒë¦¬ê¸° (+15 XP)</button>
            <button class="btn-action" onclick="triggerAction('dishes')">ğŸ½ï¸ ì„¤ê±°ì§€ í•˜ê¸° (+20 XP)</button>
        </div>

        <div class="player-hud">
            <div class="hud-row">
                <span class="lvl-text">LV.<span id="ui-lvl">46</span></span>
                <span class="xp-text"><span id="ui-cur">0</span> / <span id="ui-max">100</span> XP</span>
            </div>
            <div class="xp-track">
                <div class="xp-fill" id="ui-bar"></div>
            </div>
        </div>
    </div>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; overlayElement: #ar-ui; requiredFeatures: hit-test;"
        vr-mode-ui="enabled: false"
        ar-mode-ui="enabled: true; enterAREnabled: true;"
        renderer="alpha: true; antialias: true; colorManagement: true;">

        <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>

        <a-light type="ambient" intensity="0.7"></a-light>
        <a-light type="directional" intensity="0.8" position="-1 2 1"></a-light>

        <a-entity id="world-space"></a-entity>

    </a-scene>

    <script>
        // --- [ê²Œì„ ë°ì´í„°] ---
        let level = 46;
        let currentXP = 45;
        let maxXP = 100;

        // í™œë™ë³„ ë°ì´í„°
        const ACTIONS = {
            'vacuuming': { title: 'Vacuuming', xp: 15 },
            'dishes': { title: 'Washing Dishes', xp: 20 }
        };

        // --- [1. AR ì‹œì‘ ë¡œì§] ---
        function startAR() {
            const scene = document.querySelector('a-scene');
            const startDiv = document.getElementById('start-screen');
            const uiDiv = document.getElementById('ar-ui');

            // WebXR ì„¸ì…˜ ì‹œì‘ (ì¹´ë©”ë¼ ì¼œê¸°)
            // ì£¼ì˜: HTTPS í™˜ê²½ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤.
            try {
                scene.enterVR(); 
            } catch(e) {
                alert("AR ì‹œì‘ ì‹¤íŒ¨: HTTPS ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.");
            }

            // í™”ë©´ ì „í™˜ (UI ë³´ì´ê¸°)
            startDiv.style.opacity = '0';
            setTimeout(() => {
                startDiv.style.display = 'none';
                uiDiv.style.display = 'flex';
                updateHUD(); // ì´ˆê¸°ê°’ í‘œì‹œ
            }, 500);
        }

        // --- [2. í–‰ë™ ê°ì§€ ë° 3D í…ìŠ¤íŠ¸ ìƒì„±] ---
        function triggerAction(key) {
            const data = ACTIONS[key];
            const container = document.getElementById('world-space');
            const camera = document.querySelector('a-camera');

            // 1) ìœ„ì¹˜ ê³„ì‚°: ì¹´ë©”ë¼ê°€ ë³´ê³  ìˆëŠ” ë°©í–¥ 1.5m ì•
            const pos = camera.object3D.position;
            const dir = new THREE.Vector3(0, 0, -1.5).applyQuaternion(camera.object3D.quaternion);
            
            // 2) 3D ìš”ì†Œ ìƒì„± (HTML String í™œìš©)
            const el = document.createElement('a-entity');
            el.setAttribute('position', {x: pos.x + dir.x, y: pos.y + dir.y, z: pos.z + dir.z});
            el.setAttribute('look-at', '[camera]'); // í…ìŠ¤íŠ¸ê°€ ë‚˜ë¥¼ ë°”ë¼ë´„

            el.innerHTML = `
                <a-text value="${data.title}" align="center" position="0 0.2 0" scale="1.5 1.5 1.5" color="#ffffff" font="mozillavr"></a-text>
                <a-entity position="0 -0.15 0">
                    <a-plane color="#00E676" width="0.7" height="0.25" opacity="0.9"></a-plane>
                    <a-text value="+${data.xp} XP" align="center" z-offset="0.01" scale="1.5 1.5 1.5" color="#000"></a-text>
                </a-entity>
            `;

            container.appendChild(el);

            // 3) ì• ë‹ˆë©”ì´ì…˜ (ìœ„ë¡œ ë‘¥ë‘¥ + ì‚¬ë¼ì§)
            el.setAttribute('animation', {
                property: 'position',
                to: `${pos.x + dir.x} ${pos.y + dir.y + 0.6} ${pos.z + dir.z}`,
                dur: 2000,
                easing: 'easeOutQuad'
            });

            // 2ì´ˆ ë’¤ ì‚­ì œ
            setTimeout(() => { 
                if(el.parentNode) el.parentNode.removeChild(el); 
            }, 2000);

            // 4) ê²½í—˜ì¹˜ ë°˜ì˜
            addXP(data.xp);
        }

        // --- [3. ë ˆë²¨ì—… ì‹œìŠ¤í…œ] ---
        function addXP(amount) {
            currentXP += amount;
            
            // ë ˆë²¨ì—… ì²´í¬
            if (currentXP >= maxXP) {
                currentXP -= maxXP;
                level++;
                maxXP = Math.floor(maxXP * 1.1); // ë‹¤ìŒ ë ˆë²¨ì€ ë” ì–´ë µê²Œ
                
                // ë ˆë²¨ì—… íš¨ê³¼ (í…ìŠ¤íŠ¸ ìƒ‰ìƒ ê¹œë¹¡ì„)
                const lvlTxt = document.querySelector('.lvl-text');
                lvlTxt.style.color = '#FFD700'; // ê¸ˆìƒ‰
                setTimeout(() => lvlTxt.style.color = 'white', 1000);
            }
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('ui-lvl').innerText = level;
            document.getElementById('ui-cur').innerText = currentXP;
            document.getElementById('ui-max').innerText = maxXP;
            
            const pct = Math.min((currentXP / maxXP) * 100, 100);
            document.getElementById('ui-bar').style.width = `${pct}%`;
        }
    </script>
</body>
</html>
